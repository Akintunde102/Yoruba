<?php include('header.html'); ?>

	<?php

	//if form has been submitted process it
	if(isset($_POST['submit'])){

		$_POST = array_map( 'stripslashes', $_POST );

		//collect form data
		extract($_POST);

		

if (!empty($Email)){		
		$query = $db->prepare("SELECT * FROM members  WHERE Email = ? ");
$query->bindValue( 1, $Email );
$query->execute();

if( $query->rowCount() > 0 ) { # If rows are found for query
     $error[] = 'A form has already been Submitted with this Email';
}
	

				}
		
		//very basic validation
		if($Email =='' && count($error) == 0){
			$error[] = 'Please enter your Email Address.';
		}
		
		
	
		
		if($FullName ==''  && count($error) == 0){
			$error[] = 'Please enter your Full Name.';
		}

		if($Year =='' && count($error) == 0 ){
			$error[] = 'Please enter Your day of Birth.';
		}

		if($Month =='' &&  count($error) == 0){
			$error[] = 'Please enter Your Month of Birth.';
		}
		
		
		if($Day =='' && count($error) == 0){
			$error[] = 'Please enter Your Day of Birth.';
		}
		
		if($Address =='' && count($error) == 0){
			$error[] = 'Please enter your Residential Address.';
		}
		
		if($StateO =='' && count($error) == 0){
			$error[] = 'Please enter your State of Origin.';
		}
		
		if($TownO =='' && count($error) == 0){
			$error[] = 'Please enter your town of Origin.';
		}
		
		if($PlaceB =='' && count($error) == 0){
			$error[] = 'Please enter the your Place of birth.';
		}
		
			if(isset($_FILES['image'])){
	
		$file_name = $_FILES['image']['name'];
		$file_size =$_FILES['image']['size'];
		$file_tmp =$_FILES['image']['tmp_name'];
		$file_type=$_FILES['image']['type'];   
		$file_ext=strtolower(end(explode('.',$_FILES['image']['name'])));
		
		$expensions= array("jpeg","jpg","png"); 		
		if(in_array($file_ext,$expensions)=== false){
			$error[]="extension not allowed, please choose a JPEG or PNG file.";
		}
		if($file_size > 500000){
		$error[]='File must be 500kb or less';
		}				
		if(empty($error)==true){
		$destination = "passport/".$file_name;
			move_uploaded_file($file_tmp,$destination);
			echo "Success";
		}
	}
	else if (count($error) == 0) {$error[] = 'Please Upload Your Passport Photograph';}
		
		

		if(!isset($error)){

			try {

				//insert into database
				$stmt = $db->prepare('INSERT INTO `members`(`FullName`, `Year`, `Month`, `Day`, `Email`, `Address`, `StateO`, `TownO`, `PlaceB`, `regdate`, `image`) VALUES (:FullName, :Year, :Month, :Day, :Email, :Address, :StateO, :TownO, :PlaceB, :regdate, :image)') ;
				$stmt->execute(array(
					':FullName' => $FullName,
					':Year' => $Year,
					':Month' => $Month,
					':Day' => $Day,
					':Email' => $Email,
					':Address' => $Address,
					':StateO' => $StateO,
					':TownO' => $TownO,
					':PlaceB' => $PlaceB,
					':regdate' => date('Y-m-d H:i:s'),
					':image' => $destination
				));

				//redirect to index page
				unset($_POST);
				$_SESSION['success'] = 'Your Membership Registration Has been Successfully Submitted, You will be contacted via Your Email Address Soon';
				header('Location: registration.html');
				exit;

			} catch(PDOException $e) {
			    echo $e->getMessage();
			}

		}

	}

	?>

	<div class="page-heading text-center" style="background: black;">

		<div class="container zoomIn animated">
			<h1 class="page-title">MEMBERSHIP REGISTRATION <span class="title-under"></span></h1>
			<p class="page-description">
			Register to be a Member Here	
			</p>
			
		</div>

	</div>

	<div class="main-container fadeIn animated" >

		<div class="container">

			<div class="row">

				<div class="col-md-8 col-md-offset-2 col-form">

				
				
					<h2 class="title-style-2">Membership Registration<span class="title-under"></span></h2>

					
					
							
							  <?php 
	//check for any errors
	if(isset($error)){
	echo '<div class="form-group alerts"><div class="alert alert-danger" role="alert">';
		foreach($error as $error){
			echo $error;
		}
	echo '</div></div>';	
	} ?>
	
	
	
							  <?php 
	//check for any errors
	if(isset($_SESSION['success'])){
	echo '<div class="form-group alerts"><div class="alert alert-success" role="alert">';
	echo $_SESSION['success'];
	
	echo '</div></div>';	
	unset ($_SESSION['success']);
	} ?>
							
					<form action="http://<?=$site_address?>/registration.html" method='post' style="margin-bottom: 10px;" enctype="multipart/form-data">
					<p> *All fields are compulsory</p>
						<div class="row">
						<div class="form-group col-md-12">
                            <input name="FullName"  value='<?php if(isset($error)){ echo $_POST['FullName'];}?>' class="form-control" placeholder="Full Name*" required />
                        </div>
                        </div>
						
						<div class="row">
						<label class="form-group col-md-3 control-label">	<h3 style="margin: 0 0 0 0;" >Passport Photograph* :</h3></label>
						<div class="form-group col-md-9">
                            <input name="image" type="file" class="form-control" placeholder="Passport Image" required />
                        </div>
                        </div>
						
						


						<div class="row">
					    
						<label class="form-group col-md-3 control-label">	<h3 style="margin: 0 0 0 0;" >Date of Birth* :</h3></label>
					
							
							<div class="form-group col-md-3">
							<select name="Year" class="form-control" placeholder="Year*" required>
                        <option value="">Year*</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1998'){echo 'selected';}?>>1998</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1997'){echo 'selected';}?>>1997</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1996'){echo 'selected';}?>>1996</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1995'){echo 'selected';}?>>1995</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1994'){echo 'selected';}?>>1994</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1993'){echo 'selected';}?>>1993</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1992'){echo 'selected';}?>>1992</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1991'){echo 'selected';}?>>1991</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1990'){echo 'selected';}?>>1990</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1989'){echo 'selected';}?>>1989</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1988'){echo 'selected';}?>>1988</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1987'){echo 'selected';}?>>1987</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1986'){echo 'selected';}?>>1986</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1985'){echo 'selected';}?>>1985</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1984'){echo 'selected';}?>>1984</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1983'){echo 'selected';}?>>1983</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1982'){echo 'selected';}?>>1982</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1981'){echo 'selected';}?>>1981</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1980'){echo 'selected';}?>>1980</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1979'){echo 'selected';}?>>1979</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1978'){echo 'selected';}?>>1978</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1977'){echo 'selected';}?>>1977</option>
                        <option <?php if(isset($error) && !empty($_POST['Year']) && $_POST['Year'] == '1976'){echo 'selected';}?>>1976</option>
                      </select>
	                        </div>

	                         <div class="form-group col-md-3">
	                       <select name="Month" class="form-control" placeholder="Month*" required>
                        <option value="">Month*</option>
                        <option  <?php if(isset($error) && !empty($_POST['Month']) && $_POST['Month'] == 'January'){echo 'selected';}?>>January</option>
                        <option <?php if(isset($error) && !empty($_POST['Month']) && $_POST['Month'] == 'February'){echo 'selected';}?>>february</option>
                        <option <?php if(isset($error) && !empty($_POST['Month']) && $_POST['Month'] == 'March'){echo 'selected';}?>>March</option>
                        <option <?php if(isset($error) && !empty($_POST['Month']) && $_POST['Month'] == 'April'){echo 'selected';}?>>April</option>
                        <option <?php if(isset($error) && !empty($_POST['Month']) && $_POST['Month'] == 'May'){echo 'selected';}?>>May</option>
						 <option <?php if(isset($error) && !empty($_POST['Month']) && $_POST['Month'] == 'June'){echo 'selected';}?>>June</option>
                        <option <?php if(isset($error) && !empty($_POST['Month']) && $_POST['Month'] == 'July'){echo 'selected';}?>>July</option>
                        <option <?php if(isset($error) && !empty($_POST['Month']) && $_POST['Month'] == 'August'){echo 'selected';}?>>August</option>
                        <option <?php if(isset($error) && !empty($_POST['Month']) && $_POST['Month'] == 'September'){echo 'selected';}?>>September</option>
                        <option <?php if(isset($error) && !empty($_POST['Month']) && $_POST['Month'] == 'October'){echo 'selected';}?>>October</option>
                        <option <?php if(isset($error) && !empty($_POST['Month']) && $_POST['Month'] == 'Novemeber'){echo 'selected';}?>>November</option>
                        <option <?php if(isset($error) && !empty($_POST['Month']) && $_POST['Month'] == 'December'){echo 'selected';}?>>December</option>
                      </select> </div>
							
							
	                         <div class="form-group col-md-3">
	                       <select name="Day" class="form-control" placeholder="Day*" required>
                        <option value="">Day*</option>
                        <option <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '1'){echo 'selected';}?>>1</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '2'){echo 'selected';}?>>2</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '3'){echo 'selected';}?>>3</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '4'){echo 'selected';}?>>4</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '5'){echo 'selected';}?>>5</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '6'){echo 'selected';}?>>6</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '7'){echo 'selected';}?>>7</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '8'){echo 'selected';}?>>8</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '9'){echo 'selected';}?>>9</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '10'){echo 'selected';}?>>10</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '11'){echo 'selected';}?>>11</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '12'){echo 'selected';}?>>12</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '13'){echo 'selected';}?>>13</option>
                        <option <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '14'){echo 'selected';}?>>14</option>
                        <option <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '15'){echo 'selected';}?>>15</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '16'){echo 'selected';}?>>16</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '17'){echo 'selected';}?>>17</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '18'){echo 'selected';}?>>18</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '19'){echo 'selected';}?>>19</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '20'){echo 'selected';}?>>20</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '21'){echo 'selected';}?>>21</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '22'){echo 'selected';}?>>22</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '23'){echo 'selected';}?>>23</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '24'){echo 'selected';}?>>24</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '25'){echo 'selected';}?>>25</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '26'){echo 'selected';}?>>26</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '27'){echo 'selected';}?>>27</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '28'){echo 'selected';}?>>28</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '29'){echo 'selected';}?>>29</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '30'){echo 'selected';}?>>30</option>
                        <option  <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['Day'] == '31'){echo 'selected';}?>>31</option>
                      </select> </div>
							
						</div>
						
						
						<div class="row">
						<div class="form-group col-md-12">
                            <input value='<?php if(isset($error)){ echo $_POST['Email'];}?>' type="email" name="Email" class="form-control" placeholder="Email Address*" required />
                        </div>
                        </div>
						
						<div class="row">
						<div class="form-group col-md-12">
                            <input value='<?php if(isset($error)){ echo $_POST['Address'];}?>' type="text" name="Address" class="form-control" placeholder="Residential Address*" required />
                        </div>
                        </div>
						
						<div class="row">
						   <div class="form-group col-md-6">
	                       <select name="StateO" class="form-control" placeholder="" required>
                        <option>State of Origin*</option>
                        <option <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['StateO'] == 'Ondo'){echo 'selected';}?>>Ondo</option>
                        <option <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['StateO'] == 'Ekiti'){echo 'selected';}?>>Ekiti</option>
                        <option <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['StateO'] == 'Osun'){echo 'selected';}?>>Osun</option>
                        <option <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['StateO'] == 'Lagos'){echo 'selected';}?>>Lagos</option>
                        <option <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['StateO'] == 'Oyo'){echo 'selected';}?>>Oyo</option>
						 <option <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['StateO'] == 'Ogun'){echo 'selected';}?>>Ogun</option>
                        <option <?php if(isset($error) && !empty($_POST['StateO']) && $_POST['StateO'] == 'Kwara'){echo 'selected';}?>>Kwara</option>
                      </select> </div>	
					  
					  
					    <div class="form-group col-md-6">
                            <input value='<?php if(isset($error)){ echo $_POST['TownO'];}?>' type="text" name="TownO" class="form-control" placeholder="Town of Origin*" required />
                        </div>
						
                      </div>
					  
					  
	<div class="row">
   <div class="form-group col-md-12">
                            <input  value='<?php if(isset($error)){ echo $_POST['PlaceB'];}?>' type="text" name="PlaceB" class="form-control" placeholder="Place of Birth*" required />
                        </div>					  
                        </div>					  
					  
					

					
						

                        

                         <div class="form-group">
                            <input type="submit" class="form-group col-md-12 btn btn-primary " name='submit' value='Submit' />
                        </div>

                        <div class="clearfix"></div>

					</form>

				</div>

			</div> <!-- /.row -->


		</div>
		


	</div>
<?php include('footer.html'); ?>